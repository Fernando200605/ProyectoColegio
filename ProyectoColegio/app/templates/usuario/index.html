{% extends 'list_generic.html' %}
{% block titulo %}
  {{ titulo }}
{% endblock %}

{% block subtitulo %}
  {{ subtitulo }}
{% endblock %}

{% block columns %}
  <th>
    <i class="fas fa-hashtag me-2"></i>ID
  </th>
  <th>
    <i class="fas fa-user me-2"></i>Nombre del Usuario
  </th>
  <th>
    <i class="fas fa-envelope me-2"></i>Email
  </th>
  <th class="text-center">
    <i class="fas fa-user-shield me-2"></i>Rol
  </th>
  <th class="text-center">
    <i class="fas fa-tools me-2"></i>Acciones
  </th>
{% endblock %}

{% block rows %}
  {% for usuario in object_list %}
    <tr>
      <td>{{ usuario.id }}</td>
      <td>{{ usuario.nombre }}</td>
      <td>{{ usuario.email }}</td>
      <td class="text-center">{{ usuario.get_rol }}</td>
      <td class="text-center">
        <button class="btn btn-sm btn-info btn-ver-usuario" data-url="{% url 'app:detalle_usuario' usuario.id %}">Ver</button>
        <a href="{% url 'app:editar_usuario' usuario.id %}" class="btn btn-sm me-1" style="background-color: #3054f7; color: #ffffff; border-radius: 8px;"><i class="fa-solid fa-pen-to-square"></i></a>
        <a href="{% url 'app:eliminar_usuario' usuario.id %}" class="btn btn-sm" style="background-color: #ff4d4d; color: white; border-radius: 8px;"><i class="fa-solid fa-trash"></i></a>
      </td>
    </tr>
  {% endfor %}

<script>
  document.querySelectorAll('.btn-ver-usuario').forEach(btn => {

  btn.addEventListener('click', () => {
    const url = btn.dataset.url;

    Swal.fire({
      title: 'Cargando...',
      allowOutsideClick: false,
      onBeforeOpen: () => Swal.showLoading()
    });

    fetch(url)
      .then(res => res.json())
      .then(data => {
        Swal.fire({
          title: data.nombre,
          icon: 'info',
          html: `
            <div class="text-start mt-2">
              <div class="mb-2">
                <span class="fw-semibold text-muted">Email</span><br>
                <span>${data.email}</span>
              </div>

              <div class="mb-2">
                <span class="fw-semibold text-muted">Rol</span><br>
                <span class="badge bg-primary">${data.rol}</span>
              </div>

              <div class="mb-2">
                <span class="fw-semibold text-muted">Estado</span><br>
                <span class="badge bg-${data.estado === 'activo' ? 'success' : 'secondary'}">
                  ${data.estado}
                </span>
              </div>

              <div>
                <span class="fw-semibold text-muted">Fecha de creación</span><br>
                <span>${data.fecha_creacion}</span>
              </div>
            </div>
          `,
          showConfirmButton: true,
          confirmButtonText: 'Cerrar',
          customClass: {
            popup: 'swal-card',
            title: 'swal-title',
            confirmButton: 'btn btn-primary px-4'
          },
          buttonsStyling: false
        });
      })
      .catch(() => {
        Swal.fire('Error', 'No se pudo cargar la información', 'error');
      });
  });

  });
</script>

{% endblock %}


