{% extends 'create_generic.html' %}
{% load widget_tweaks %}

{% block titulo %}
  {{ titulo }}
{% endblock %}

{% block form %}
  {% csrf_token %}

  {# ===== FORMULARIO DE USUARIO ===== #}
  {% for field in usuario_form.visible_fields %}
    <div class="mb-4">
      <label class="form-label fw-bold" style="color: #1C2E4A;">
        {{ field.label }}
      </label>

      {{ field|add_class:'form-control form-control-custom' }}

      {% if field.errors %}
        {% for error in field.errors %}
          <div class="text-danger mt-1 small">
            <i class="fas fa-exclamation-circle me-1"></i> {{ error }}
          </div>
        {% endfor %}
      {% endif %}
    </div>

    {# Campo confirmar contraseña  #}
    {% if field.name == 'contraseña' %}
      <div class="mb-4">
        <label class="form-label fw-bold" style="color: #1C2E4A;">Confirmar Contraseña</label>
        <input type="password"
               name="confirmar_contraseña"
               class="form-control form-control-custom"
               placeholder="Repite la contraseña">
      </div>
    {% endif %}
  {% endfor %}

  {# ===== SELECT DE ROL ===== #}
  <div class="mb-4">
    <label class="form-label fw-bold" style="color: #1C2E4A;">Rol</label>
    <select id="rol-select" name="rol" class="form-control" required>
      <option value="">Seleccione un rol</option>
      <option value="administrador" {% if rol_actual == 'administrador' %}selected{% endif %}>Administrador</option>
      <option value="docente"       {% if rol_actual == 'docente' %}selected{% endif %}>Docente</option>
      <option value="estudiante"    {% if rol_actual == 'estudiante' %}selected{% endif %}>Estudiante</option>
      <option value="acudiente"     {% if rol_actual == 'acudiente' %}selected{% endif %}>Acudiente</option>
    </select>
  </div>

  {# ===== FORMULARIOS POR ROL  ===== #}
  <div id="administrador-form" class="rol-form" style="display:none;">
    <div class="mb-4">
      <label class="form-label fw-bold" style="color: #1C2E4A;">Cargo</label>
      {{ admin_form.cargo|add_class:'form-control'|attr:"name:cargo" }}
    </div>
  </div>

  <div id="docente-form" class="rol-form" style="display:none;">
    <div class="mb-4">
      <label class="form-label fw-bold" style="color: #1C2E4A;">Especialidad</label>
      {{ docente_form.especialidad|add_class:'form-control'|attr:"name:especialidad" }}
    </div>
  </div>

  <div id="estudiante-form" class="rol-form" style="display:none;">
    <div class="mb-4"><label class="form-label fw-bold">Código</label>{{ estudiante_form.codigo|add_class:'form-control'|attr:"name:codigo" }}</div>
    <div class="mb-4"><label class="form-label fw-bold">Fecha de Nacimiento</label>{{ estudiante_form.fechaNacimiento|add_class:'form-control'|attr:'type:date'|attr:"name:fechaNacimiento" }}</div>
    <div class="mb-4"><label class="form-label fw-bold">Curso</label>{{ estudiante_form.cursoId|add_class:'form-control'|attr:"name:cursoId" }}</div>
  </div>

  <div id="acudiente-form" class="rol-form" style="display:none;">
    <div class="mb-4">
      <label class="form-label fw-bold">Teléfono</label>
      {{ acudiente_form.telefono|add_class:'form-control'|attr:"name:telefono" }}
    </div>
  </div>

  
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const rolSelect = document.getElementById('rol-select');
      const rolForms  = document.querySelectorAll('.rol-form');

      function toggleRolForm() {
        rolForms.forEach(div => {
          div.style.display = 'none';
          div.querySelectorAll('input, select, textarea').forEach(input => {
            input.disabled = true;
          });
        });
        if (rolSelect.value) {
          const formActivo = document.getElementById(rolSelect.value + '-form');
          if (formActivo) {
            formActivo.style.display = 'block';
            formActivo.querySelectorAll('input, select, textarea').forEach(input => {
              input.disabled = false;
            });
          }
        }
      }

      rolSelect.addEventListener('change', toggleRolForm);
      toggleRolForm(); 
    });
  </script>

{% endblock %}